<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Table</title>
    <style type="text/css">
        html,body{height:100%;width: 100%;}
        #da{width:100%;height:10%;}
        #db{width:100%;height:60%;}
        #dc{width:100%;height:27%;}
        .tables {width:100%;height:63%;display:none;}
        tr{font-size:13px;height:9%;cursor:pointer;}
        tr:nth-child(odd){background-color:#eaeaea;}
        .songplay{;display:none;}
        audio{width:100%;}
    </style>
</head>
<body>
<div id = "da">
<button id = "uppages">上一页</button><button id = "nextpages">下一页</button>

<label id = "labpage">1</label>
</div>
<div id = "db">

</div>
<div id = "dc">
        <audio  id = "Imp3" src="" autoplay="auto" controls = "controls"></audio>
</div>
</body>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script type="text/javascript">

var urlString = "http://s.music.qq.com/fcgi-bin/music_search_new_platform?t=0&n=3&aggr=1&cr=1&loginUin=0&format=jsonp&inCharset=GB2312&outCharset=utf-8&notice=0&platform=jqminiframe.json&needNewCode=0&p=1&catZhida=0&remoteplace=sizer.newclient.next_song&w=李健";

$.post("proxy.php", {
        urlString
      }, function(data) {
        console.log(data);
        data = JSON.parse(data)
        data['data']['song']['list'].forEach(
         console.log(data)
        )

      })

/*
$.ajax({
  type: "get",
  async: true,
  url: urlString,
  dataType: "jsonp",
  success: function(data) {
    //data = JSON.parse(data);
    console.log(data);
    var Length = data.songlist.length; //json 长度
    var listnum = 9;           //每页条数
    var Pages =  Math.floor(Length/listnum) + 1; //页数
    FenPages(Pages,listnum,data.songlist);
    NextPage(Pages);

    var oTd = document.getElementsByClassName("songplay");
    var oTr = document.getElementsByClassName("startpaly");
    for(var x = 0;x<oTd.length;x++)
    {
        oTr[x].onclick = (function(x){
            return function(){
            var Oid = oTd[x].innerHTML;
            var tUrl = "http://ws.stream.qqmusic.qq.com/"+Oid+".m4a?fromtag=46";
            $("#Imp3").attr('src',"");
            $("#Imp3").attr('src',tUrl);
            };
        })(x);

    }

  },
  error: function() {
    alert('fail');
  }
});*/


function FenPages(Pages,listnum,oJson){
    for(var j = 0;j < Pages;j++)
    {
        var tid = 'tb' + (j+1);
        $("#db").append('<table class = "tables"></table>')
        $("table").eq(j).attr('id',tid);
        for(var i = 0;i < listnum;i++){
            if( oJson.length < listnum){
                   var Shengyu = oJson.length;
                   for(var nn = 0;nn<Shengyu;nn++)
                   {
                    var stime = oJson[nn]["playtime"];
                    var smin  = parseInt(stime/60);
                    var ssend = stime%60;
                    if (ssend<10)
                    {
                        ssend = "0"+ssend;
                    }
                    var songtime = "0"+smin+":"+ssend;
                    $("table").eq(j).append('<tr class = "startpaly"><td class = "songplay">'+oJson[nn]["id"]+'</td><td>'+oJson[nn]["singerName"]+'</td><td>'+oJson[nn]["songName"]+'</td><td>'+songtime+'</td></tr>')
                   }
                   break;
            }
            else{
                var stime = oJson[i]["playtime"];
                var smin  = parseInt(stime/60);
                var ssend = stime%60;
                if (ssend<10)
                    {
                        ssend = "0"+ssend;
                    }
                var songtime = "0"+smin+":"+ssend;
                 $("table").eq(j).append('<tr class = "startpaly"><td class = "songplay">'+oJson[i]["id"]+'</td><td>'+oJson[i]["singerName"]+'</td><td>'+oJson[i]["songName"]+'</td><td>'+songtime+'</td></tr>')
            }
        }
        oJson.splice(0,listnum);
    };

    $(".tables").eq(0).css("display","table");
}



function NextPage(Pages){

var dqpage = 0;

$("#uppages").click(function() {
    if( dqpage == 0){
        alert("this is first page");
    }
    else{
    $(".tables").css("display","none");
    $(".tables").eq(dqpage - 1).css("display","table");
    $("#labpage").html(dqpage);
    dqpage = dqpage - 1;
    };
});

$("#nextpages").click(function() {
    if( dqpage + 1 == Pages){
        alert("this is end page");
    }
    else{
    dqpage = dqpage + 1;
    $(".tables").css("display","none");
    $(".tables").eq(dqpage).css("display","table");
    $("#labpage").html(dqpage+1);
    };
});

}


</script>
</html>