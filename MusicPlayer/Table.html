<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />

    <title>Table</title>
    <style type="text/css">
        html,body{height:100%;width: 100%;}
        #da{width:100%;height:10%;}
        #db{width:100%;height:60%;}
        #dc{width:100%;height:27%;}
        .tables {width:100%;height:63%;display:none;}
        tr{font-size:13px;height:9%;cursor:pointer;}
        tr:nth-child(odd){background-color:#eaeaea;}
        .songplay{display:none;}
        .songplays{display:none;}
        audio{width:100%;}
    </style>
</head>
<body>
<div id = "da">
<button id = "uppages">上一页</button><button id = "nextpages">下一页</button>

<label id = "labpage">1</label>
</div>
<div id = "db">

</div>
<div id = "dc">
        <audio  id = "Imp3" src="" autoplay="auto" controls = "controls"></audio>
</div>
</body>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script type="text/javascript">


$.ajax({
  type: "get",
  async: true,
  url:  "https://songsearch.kugou.com/song_search_v2?",
 data:{
    keyword:"刘德华",
    page:1,
    pagesize:100,
    userid:"-1",
    clientver:null,
    platform:"WebFilter",
    tag:"em",
    filter:2,
    iscorrection:1,
    privilege_filter:0
  },
  dataType: "jsonp",
  scriptCharset: 'GBK',//设置编码，否则会乱码
  success:  function(data) {
  console.log(data['data']['lists']);
  liststutas = 100;
  var Length = data['data']['lists'].length; //json 长度

    var listnum = 10;           //每页条数
    var Pages =  Math.floor(Length/listnum) + 1; //页数
    FenPages(Pages,listnum,data['data']['lists']);
    NextPage(Pages);
    var oTd = document.getElementsByClassName("songplay");
    var oTh = document.getElementsByClassName("songplays");
    var oTr = document.getElementsByClassName("startpaly");
    for(var x = 0;x<oTd.length;x++)
    {
        oTr[x].onclick = (function(x){
            return function(){
            var Oid = oTd[x].innerHTML;
            var Ohash = oTh[x].innerHTML;
            var tUrl = "http://s.music.qq.com/fcgi-bin/music_search_new_platform?t=0&n=1&aggr=1&cr=1&loginUin=0&format=jsonp&inCharset=GB2312&outCharset=utf-8&notice=0&platform=jqminiframe.json&needNewCode=0&p=1&catZhida=0&remoteplace=sizer.newclient.next_song&w=王菲&callback=?";

           $.ajax({
                  type: "post",
                  url:  tUrl,
                  dataType: "jsonp",
                  jsonp:"callback",
                  jsonpCallback: "JsonCallback",
                  scriptCharset: 'GBK',//设置编码，否则会乱码
                  success: callback = function(data) {
                    console.log(JSON.stringify(data['data']['song']['list']));
                  },
                  error: function() {
                    alert('fail');
                  }
                });



          //  $("#Imp3").attr('src',"");
           // $("#Imp3").attr('src',tUrl);

            };
        })(x);

    }

//http://fs.w.kugou.com/201712042319/a99297b859b9428502c5c2eab468e81e/G005/M01/15/00/pYYBAFS4d62AEYbaADnSIQaWH1U070.mp3

//http://fs.w.kugou.com/201712042331/2ebf8331e726402c37570d4a9133f30c/G004/M06/0E/03/pIYBAFT8PK-AL_q8AD89YuI4BWQ954.mp3

//http://www.kugou.com/yy/index.php?r=play/getdata&hash=D0ECC68A97ECC7E538CE47BF2A4812DB

//http://www.kugou.com/song/#hash=D0ECC68A97ECC7E538CE47BF2A4812DB&album_id=969928


//http://www.kugou.com/song/#hash=44352CFC64B0BD13875D4BF63ABFF17C&album_id=7952019


  },
  error: function() {
    alert('fail');
  }
});

//http://www.kugou.com/song/#hash=44352CFC64B0BD13875D4BF63ABFF17C&album_id=7952019


function FenPages(Pages,listnum,oJson){
    for(var j = 0;j < Pages;j++)
    {
        var tid = 'tb' + (j+1);
        $("#db").append('<table class = "tables"></table>')
        $("table").eq(j).attr('id',tid);
        for(var i = 0;i < listnum;i++){
            if( oJson.length < listnum){
                   var Shengyu = oJson.length;
                   for(var nn = 0;nn<Shengyu;nn++)
                   {
                    var stime = oJson[nn]["Duration"];
                    var smin  = parseInt(stime/60);
                    var ssend = stime%60;
                    if (ssend<10)
                    {
                        ssend = "0"+ssend;
                    }
                    var songtime = "0"+smin+":"+ssend;
                    $("table").eq(j).append('<tr class = "startpaly"><td class = "songplay">'+oJson[nn]["AlbumID"]+'</td><td class = "songplays">'+oJson[nn]["FileHash"]+'</td><td>'+oJson[nn]["AlbumName"]+'</td><td>'+oJson[nn]["FileName"]+'</td><td>'+songtime+'</td></tr>')
                   }
                   break;
            }
            else{
                var stime = oJson[i]["Duration"];
                var smin  = parseInt(stime/60);
                var ssend = stime%60;
                if (ssend<10)
                    {
                        ssend = "0"+ssend;
                    }
                var songtime = "0"+smin+":"+ssend;
                 $("table").eq(j).append('<tr class = "startpaly"><td class = "songplay">'+oJson[i]["AlbumID"]+'</td><td class = "songplays">'+oJson[i]["FileHash"]+'</td><td>'+oJson[i]["AlbumName"]+'</td><td>'+oJson[i]["FileName"]+'</td><td>'+songtime+'</td></tr>')
            }
        }
        oJson.splice(0,listnum);
    };

    $(".tables").eq(0).css("display","table");
}



function NextPage(Pages){

var dqpage = 0;

$("#uppages").click(function() {
    if( dqpage == 0){
        alert("this is first page");
    }
    else{
    $(".tables").css("display","none");
    $(".tables").eq(dqpage - 1).css("display","table");
    $("#labpage").html(dqpage);
    dqpage = dqpage - 1;
    };
});

$("#nextpages").click(function() {
    if( dqpage + 1 == Pages){
        alert("this is end page");
    }
    else{
    dqpage = dqpage + 1;
    $(".tables").css("display","none");
    $(".tables").eq(dqpage).css("display","table");
    $("#labpage").html(dqpage+1);
    };
});

}


</script>
</html>